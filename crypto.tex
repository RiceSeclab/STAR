\label{sec:crypto}


% Notations: 
% \begin{compactitem}
% \item $cv = E_K(v)$ encryption of vote $v$ with proof $p_c$ 
% \item $cs = E_K(s)$ serial number $s$ encryption
% \item $c = (cv, cs)$
% \item $z_i$ hash chaining
% \item $f_i$ hash of encrypted ciphertext
% \item $\pi$ permutation used in verifiable shuffle
% \item $m$ voting machine id
% \end{compactitem}

\paragraph{The core elements}
\label{sec:crypto-core}

% From the perspective of election officials, the first new element in
% the election regiment is the cryptographic key generation process. A
% set of election trustees is designated as key holders and a threshold
% number is fixed. The functional effect is that if there are $n$
% election trustees and the threshold value is $t$, then any $t$ of the
% $n$ trustees can complete the election â€“ even if the remaining $n-t$
% are unavailable. This threshold mechanism provides robustness while
% preventing any fewer than $t$ of the trustees from performing election
% functions which might compromise voter privacy. Depending on the
% availability of the election trustees and on the desired amount of
% robustness, a choice between two procedures can be made: either the
% trustees are available for a general two-steps key generation
% procedure, or a simpler one-step procedure can be adopted if $t=n$.

The most important cryptographic element in STAR-Vote is the cryptosystem
that is used to encrypt ballots.  This should be a threshold cryptosystem
(so that decryption capabilities are distributed to protect voter privacy)
that has an additive homomorphic property (to allow individual encrypted ballots to
be combined into an aggregate encryption of the tally).  An exponential
version of the ElGamal cryptosystem satisfies the required properties.

Cryptographic key generation can be accomplished in one of two ways ---
depending on the availability of the election trustees and the desired
amount of robustness.  The preferred approach is a two-step process,
but a simpler one-step process can be used if the robustness is eliminated.
At the end of the key generation procedure, the trustees each hold a
private key share that does not contain any information on the full
private key, and the unique public key $K$ corresponding to those
shares is published.

During the polling phase, the ballot marking devices encrypt the votes
of each voter using the public key $K$. This encryption procedure is
randomized in order to make sure that two votes for the same
candidates result in ciphertexts that look independent to any
observer. 

A short hash value of each ciphertext is also computed, e.g., by
truncating the output of the SHA-256 hash function.  This hash provides
a unique fingerprint of the ballot, which is provided to the voter as
part of the take-home receipt. All the ciphertexts and hashes that are
computed are posted on a publicly accessible web page, either
immediately or as soon as the polls are closed. This web page is
digitally signed by the election office using a traditional signature
key (not the key generated by the trustees).

The posting of all of the encrypted ballots and hashes gives all voters
the ability to verify that their ballots have been properly recorded.
Additionally, this web page makes it possible for observers
to confirm the homomorphic aggregation of the individual ballots into a
single encryption of the sum of the ballots (which constitutes an encryption
of the election tallies). 

At the end of the election, any set of trustees that achieve the pre-set quorum
threshold use their respective private keys to decrypt the derived aggregate tally
encryption.  This procedure is simple and efficient and can be completed
without interaction between the trustees.  We note that the individual 
encrypted ballots from --- which the aggregate encryption of the tallies is formed
--- are never individually encrypted.  However, each spoiled ballot {\em is}
individually decrypted using exactly the same process that is used to decrypt
the aggregate tally encryption.

The elements we just described make the core of the workflow and are
sufficient to compute an election tally while preserving the privacy
of the votes. We now explain various ways in which this simple
workflow is hardened in order to make sure that the tally is also
correct. All the techniques that follow enable the verification of
different aspects of the ballot preparation and casting.

\paragraph{Hardening encryption}
\label{sec:hardening-encryption}
Since the tally does not involve the decryption of any individual
ballot, and since the audit procedure relies on the fact that all
counted ballots are properly formed, it is crucial to make sure that
all the encrypted ballots that are added correspond to valid votes.
This is achieved by requiring the ballot marking devices to compute,
together with the encryption of the votes, a non-interactive
zero-knowledge (NIZK) proof that each ballot is well-formed. Such a
proof guarantees that each ciphertext encrypts a valid vote and does not
leak any other information about the content of the vote. As a side
benefit, this proof can be designed to make the ballots non-malleable,
which provides an easy technique to prevent the replay of old ballots
(i.e., reject duplicates).

\paragraph{Hardening decryption}
\label{sec:hardening-decryption}
Making sure that the encrypted ballots are valid is not enough: we
also need to make sure that the tally is correctly decrypted as a
function of those encrypted ballots: otherwise, malicious trustees (or
trustees using corrupted devices) could publish an outcome that does
not correspond to these ballots. As a result, we require the trustees
to provide evidence of the correctness of the decryption operations
that they perform.  This can also be accomplished with NIZK proofs,
although exponential ElGamal and many other suitable cryptosystems
allow a single value to be published to enable observers to verify that
the decryption is correct.

\paragraph{Hardening the timeline}
\label{sec:hard-timeline}

The procedures described above prevent malfunctioning or corrupted
voting terminals or trustees to falsify individual ballots or decryption
operations.

The detection of manipulation of encrypted ballots can be more
effective by linking ballots with each other, using hash chaining.
For this purpose, each ballot marking device is seeded, at the beginning
of the election, with a public start value $z_0$ that includes a
unique identifier for the election.
This unique identifier should be chosen at random shortly before the
election.

% This unique identifier should be
% hard to predict and chosen as close as possible from the beginning of
% the polls in order to reduce the time frame during which a malicious
% party could prepare an attack.

This $z_0$ seed is then used as follows: as soon as a voting terminal
with identifier $m$ computes an encrypted ballot $b_i$, it
computes a hash $z_i := H(b_i \| m \| z_{i-1})$ and transmits the value
to the judge's station. A truncated version of $z_i$ forms the hash code
that appears on the voter's take-home receipt.  When the polls close,
the final $z$ value is digitally signed and made public.

As a result of this procedure, any removed ballot will
invalidate the hash chain which is committed to at the close of the
election and whose constituents appear on voter's taken-home receipts.

\paragraph{Hardening the link between the paper and electronic
  election outcome}
\label{sec:hard-link-betw}

The voting terminals print human-readable versions of each
ballot summary which can be inspected for correctness by voters.
In addition to the cast or challenge procedure discussed above,
a risk-limiting audit provides further insurance that the
election outcome that could be computed from the paper ballots matches
the one that is computed from the decryption of the encrypted election
outcome.
To support the risk-limiting audit, a cryptographic hash structure
must be built according to the SOBA schema (see section~\ref{sec:audit}).
This structure is composed from the raw votes on each of the ballots.
While it would be possible to obtain these raw votes by decrypting the
individual encrypted ballots, this operation (which would require participation
of the election trustees) is not necessary.  Instead, the voting terminals
have all the data needed to construct the SOBA structure and they can either
build the structure in real time during the election or encrypt it for
later processing.\footnote{
The encryption here is simply an operational safeguard to avoid storing raw
cast vote records on the voting terminals or judge's stations.
This can be accomplished with conventional encryption techniques and need
not involve the election trustees.}

\paragraph{The full cryptographic protocol}
\label{sec:full-protocol}
The resulting cryptographic workflow is as follows. 
\begin{enumerate}
\item The trustees jointly generate a threshold public key/private key
  encryption pair. The encryption key $K$ is published.
\item Each voting terminal is initialized with the ballot/election
  parameters, the public key $K$ and a unique seed $z_0$ that is
  computed by hashing all election parameters and using a public
  random salt.
\item When a voter completes the ballot marking process selection
  to product a ballot $v$, the voting terminal performs the following operations: 
  \begin{enumerate}
  \item It selects a unique ballot serial number $s$.
  \item It computes an encryption $c_v = E_K(v)$ of the vote, as
    well as a NIZK proof $p_v$ that $c_v$ is a valid ballot encryption.
  \item It computes a hash code $z_i = H(c_v \| p_v \| m \| z_{i-1})$,
    where $m$ is the voting terminal unique identifier.
  \item It prints a paper ballot in two parts. The first contains $v$
    in a human readable format as well as $s$ in a robust machine
    readable format (e.g., a barcode). The second is a voter take-home
    receipt that includes, the voting terminal identifier $m$, the date
    and time, and the hash code $z_i$ (or a truncation thereof).
  \item It transmits $(c_v, p_v, m, z_i, s)$ to
    the judge's station which will ultimately publish all of these values
    {\em except\/} $s$.
  \end{enumerate}
\item When a ballot is cast, the serial number $s$ is scanned and sent
  to the judge's station.  The judge's station then marks the associated ballot
  as complete and ready to be included in the tally.
\item When the polls are closed, the tally is computed: the product
  $c$ of all flagged encrypted votes is computed and verifiably
  decrypted, providing an election result $r$.
\item A hash structure is computed to support the SOBA audit described in
  section~\ref{sec:audit}.
\end{enumerate}

All stored data can then be digitally signed and published by the
local authority. Those audit data are considered to be valid if the
hash chain checks and if all cryptographic proofs check, that is, if
the ballot validity proofs check, it $c$ is computed and decrypted
correctly, and if all spoiled ballots are decrypted correctly..


% \paragraph{Summing up} The elements described above lead to the
% following workflow. \COP{Sum up, explaining how all elements are
%   computed and in what order.}
% \begin{compactenum}
% \item The trustees choose a threshold $t$ and run a the corresponding
%   key generation procedure. At the end of this procedure, each trustee
%   holds a private key and a unique public key $K$ is published.
% \item At the beginning of the election day, a public start value $z_0$
%   is chosen that uniquely identifies the election and voting
%   office. All ballot marking devices are initialized with the election
%   specifics (ballot format, \dots), with the key $K$ and with the seed $z_0$.
% \item After the completion of the selection by each voter, the ballot
%   marking device proceeds as follows.
%   \begin{compactenum}[a.]
%   \item It computes an encryption $b_i$ of the voter's selection using
%     the public key $K$, together with a ballot validity proof
%     $pb_i$. These elements are hashed in order to produce a ballot
%     fingerprint $f_i = H(b_i, pb_i, z_{i-1}, m)$.
%   \item It produces paper printouts of two items. The first is the
%     paper ballot which consists of the selections made by the voter
%     and $f_i$. The second is a receipt that consists of an
%     identification number $m$ for the ballot marking device, the date
%     and time of the vote, and a truncated SHA-256 hash of the \elgamal
%     encryption of the voterâ€™s selections together with the previous
%     hash value.

%   \end{compactenum}
% \end{compactenum}


%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "star"
%%% End: 
