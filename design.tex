\label{sec:design}

From the perspective of voters, the process of registration and poll-station sign-in is unchanged from current practice.  Once authorized, voters proceed to a voting terminal where they use rich interface that prevents overvotes, warns of undervotes, and supports alternative input/output media for disabled and impaired voters. The printed ballot summary, as well as the corresponding electronic ballot record, includes a variety of cryptographic features, which we now describe.

% After indicating their selections, voters each receive two (possibly joined) items from a ballot marking device:  a printed ballot listing their selections and a take-home printed receipt that includes information about the device and time of the vote as well as a short (12-16 byte) hash code which incorporates an encryption of the voter's selections together with those of prior voters.

% Voters can then review their printed ballots and decide whether they are happy with the indicated selections.  Satisfied voters can then deposit their paper ballots into a ballot box to complete the process.  Voters can alternately approach a poll worker to have their ballots spoiled and be given the option to return to a ballot marking device to start the process anew.

% Voters who care to do so can later check their receipts (both cast and spoiled) against a published list to verify their correctness.

\subsection{Crypto Overview}
From the perspective of election officials, the first new element in the election regimen is 
to generate the cryptographic keys.  
A set of election trustees is designated as key holders and a threshold number is fixed.  
The functional effect is that if there are $n$ election trustees and the threshold value is $k$, then any $k$ of the $n$ trustees can complete the election, even if the remaining $n-k$ are unavailable.  This threshold mechanism provides robustness while preventing any fewer than $k$ of the trustees from performing election functions that might compromise voter privacy. 
Threshold cryptosystems are straightforward extensions of traditional public-key cryptosystems~\cite{desmedt90threshold}.

The trustees each generate a key pair consisting of a private key and
a public key; they publish their public keys.  
A standard public
procedure is then used to compute a single public key from the $n$
trustee public keys such that decryptions can be performed by any $k$
of the trustees.  This single election public key $K$ is published and
provided to all voting terminals together with all necessary
ballot style information to be used in the election.  
Each voting terminal is also seeded with a start value $z_0$ that includes a
unique identifier for both the voting office and the election.

During the election, voters use voting terminals to make their
selections.  Once selections are completed, the voting terminal
produces paper printouts of two items.  The first is the paper ballot summary
which consists of the selections made by the voter and also includes a
random (non-sequential) serial number.  The second is a receipt that
consists of an identification number for the voting terminal,
the date and time of the vote, and a short (16-20 character) hash of the encryption of
the voter's selections together with the previous hash value.
Specifically, if the voter's selections are denoted by $v$, the
$i^{{\mathrm th}}$ hash value produced by a particular voting terminal $m$ in an election is computed as
\[
z_i=H(E_K(v),m,z_{i-1} )
\]
\noindent
where $H$ denotes the hash function and $E$ denotes encryption.

The voting terminal should retain both the encrypted ballots and the current hash value.  At the conclusion of the election (if not sooner), the encrypted ballots should be posted on a publicly-accessible web page and digitally signed by the election office using a simple signature key (not the key generated by the trustees).  The posting of each encrypted ballot should also include a non-interactive zero-knowledge (NIZK) proof that the ballot is well-formed.
Once they receive their ballots summaries and take-home receipts, voters may either deposit their ballot summaries into a ballot box or take them to a poll-worker and have them spoiled.  Ballot summaries deposited in a ballot box have their serial numbers scanned and recorded.  The electronically stored encrypted vote is not considered complete (and not included in the tally) unless and until its corresponding serial number has been recorded in the ballot box.

Any electronic stored encrypted ballots for which no corresponding serial number has been scanned and recorded are deemed spoiled.  The published election record should include all spoiled ballots as well as all cast ballots, but for each spoiled ballot the published record should also include a verifiable decryption of the ballot's contents.  Voters should be able to easily look up digitally-signed records for any receipts they hold and verify their presence and, for spoiled receipts, the ballot contents.

A voter who takes a completed paper ballot summary to a poll worker can request that the poll worker spoil the ballot and give the voter an opportunity to re-vote.  
The poll worker marks both the take-home receipt and the paper ballot summary as spoiled (including removing or marking the serial number so that it will not be recorded if subsequently placed in the ballot box) and returns the spoiled ballot summary to the voter.

Upon completion of the election, the election office homomorphically combines the cast ballots into an aggregate encryption of the election tally (this can be as simple as a multiplication of the public encrypted ballots).  At least $k$ of the election trustees then each perform their share of the decryption of the aggregate as well as individual decryptions of each of the spoiled ballots.  The trustees also post data necessary to allow observers to verify the accuracy of the decryptions.

% After the tally is announced and the verification data is published, the set of cast ballots is verifiably shuffled with a mix network.  This shuffling could be performed by the same trustees who act as key holders, but the shuffling task could be performed by other parties or even by the election office.
A privacy-preserving risk-limiting audit is then performed by randomly selecting paper ballot summaries and matching each selected ballot with a corresponding encrypted ballot to demonstrate the correct matching and provide software-independent evidence of the outcome~\cite{rivest06sivoting,lindemanStark12,starkWagner12}.

\subsection{Triple Assurance}

Three lines of evidence are produced to support each election outcome~\cite{starkWagner12}.  The homomorphic tallying process proves that the announced tally corresponds to the posted encrypted ballot records.  The ballot challenge and receipt checking processes allow voters to check that these encrypted ballot records correctly reflect their selections.  The risk-limiting audit process provides an independent check that a hand count of the paper ballots matches the outcome which a hand count of the paper records would produce.  In addition, the 
paper records remain available in case of systemic failure of the electronic records or 
if a manual count is ever desired.
The paper and electronic records are conveyed to the local election office separately, providing
additional physical security of the redundant audit trail.

The design of the election system ensures that all three of these checks should be perfectly consistent.  There is sufficient information in the records so that if any discrepancies arise (for instance because of loss of some of the electronic or paper records), the discrepancies can be isolated to individual ballots that are mismatched or counted differently.

\subsection{Software and Hardware Engineering}

An important criteria for \projname is that it should leverage commodity components whenever feasible. This reduces cost and simplifies the ability for an election administrator to replace aging hardware by sourcing it from multiple vendors. While this paper isn't intended to cover certification issues, the separation of hardware and software allows for the possibility of {\em commercial off-the-shelf} (COTS) hardware, which {\em could} be subject to a lower bar for certification than the software.

Ideally, the voting terminals and the judge station could use identical hardware. In particular, we believe that a reasonable target might be ``point of sale'' terminals. These are used in restaurants worldwide. They are used in relatively demanding environments and, on the inside, are ordinary PCs, sometimes built from low-power laptop-class parts. The only missing hardware from a COTS point of sale terminal, relative to our needs for \projname, are a printer and a battery.

If you want a reliable, low-power printer, without having to worry about consumable ink or toner, there's only one choice: thermal printers. They come in a variety of widths, up to US Letter size. Thermal paper, particularly higher cost thermal paper, can last for years in an air-conditioned warehouse, although some experimentation would be required to see whether it can survive an un-air-conditioned trip in a hot car in the summer. Every shipping label from major online vendors like Amazon is printed thermally, lending some credence to its survivability in tough conditions.


Specifying a battery is more complicated. We could require that the voting terminal have an internal (and removable) battery, but this eliminates COTS point of sale terminals. Tablet computers come with built-in batteries that, at least in some cases, can last all day. Tablet computers have smaller screens than we might prefer, and we would have to worry about theft. Also, we would prefer to use wired networks, rather than the wireless networks built into most tablets. Perhaps the right answer is to specify a point of sale terminal with an external battery, and hope a vendor can do this without extensive customization.

For the software layer, we see no need for anything other than a commodity operating system, like Linux, which can be stripped of unessential features to reduce the attack surface. For example, we don't need a full-blown window system or 3D graphics pipeline. All we need are basic pre-rendered ballots, as in pVote~\cite{yee06prui,yee07pvote} or VoteBox~\cite{sandler08votebox}. We would specify that the voting system software be engineered in a type-safe language like Java or C\# (eliminating buffer overflow vulnerabilities, among other problems) and we would also specify that the software be engineered with {\em privilege separation}~\cite{PFH03}, running separate parts of the voting software as distinct applications, with distinct Unix user-ids, and with suitably reduced privileges. For example, the storage subsystem can maintain append-only storage for ballots. The voter-facing UI would then have no direct access to ballot storage, or the network, and could be ``rebooted'' for every voter. Consequently, a software compromise that impacts the UI application could impact at most one voter.

A separation architecture like this also provides some degree of protection over sensitive cryptographic key materials, e.g., if we want every voting terminal to have a unique private key to compute digital signatures over ballots, then we must restrict the ability for compromised software to extract the private keys. DStar~\cite{dstar2008}, for example, used this technique to protect the key material in an SSL/TLS web server.
